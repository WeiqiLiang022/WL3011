---
title: "Flexdashboard"
output: 
  flexdashboard::flex_dashboard:
    orientation: columns
    vertical_layout: fill
---
```{r setup, include = FALSE}
library(flexdashboard)
library(tidyverse)
library(plotly)
library(p8105.datasets)
library(ggplot2)
```

```{r message = FALSE, message = FALSE, warning=FALSE}

# basic dataset: ny_noaa
ny_noaa = ny_noaa |>

  mutate(
    year = format(pull(ny_noaa, date), "%Y"),
    month = format(pull(ny_noaa, date), "%m"),
    day = format(pull(ny_noaa, date), "%d")
    ) |>
  relocate(id, date, year, month, day) |> 
  mutate(
    across(-c(date, id), as.numeric),
    prcp = prcp / 10,     
    tmax = tmax / 10,     
    tmin = tmin / 10      
  )
```

Column {data-width=650}
-----------------------------------------------------------------------
```{r message = FALSE, warning=FALSE, fig.width = 7, fig.height = 7, fig.cap="Figure 1. Annual Snowfall Values Distribution"}
library(ggridges)

p2 = ny_noaa |>
  filter(snow > 0 & snow < 100) |>
  ggplot(aes(x = snow, y = year, fill = factor(year))) +
  geom_density_ridges(scale = 1.5, rel_min_height = 0.01) +  
  labs(
    x = "Snowfall (mm)",
    y = "Year",
    fill = "Year"
  ) +
  scale_y_continuous(
    breaks = seq(1980, 2010, by = 5) 
  ) + 
  theme_minimal() +
  theme(legend.position = "none")

print(p2)
```

```{r message = FALSE, warning = FALSE}
# scatter plot of tmax vs tmin by year and id
ny_noaa |>
  group_by(id, year) |>
  summarise(avg_tmax = mean(tmax, na.rm = TRUE),
            avg_tmin = mean(tmin, na.rm = TRUE)) |>
  slice(-1, -n()) |>
  mutate(text_label = paste("Station: ", id, "<br>Year: ", year, "<br>Max Temperture: ", avg_tmax, "<br>Min Temperture: ", avg_tmin)) |>
  plot_ly(
    x = ~avg_tmin, y = ~avg_tmax, type = "scatter", mode = "markers",
    color = ~avg_tmax, text = ~text_label, colors = "viridis", alpha = 0.5) |>
   layout(title = "Max Temperture vs. Min Temperture by Year and Station",
         xaxis = list(title = "Min Temperture"),
         yaxis = list(title = "Max Temperture")) |>
   colorbar(title = "Temperture")
```